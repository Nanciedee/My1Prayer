<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morning Reflection</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Delius&display=swap" rel="stylesheet">
    <!-- New font for the reminder text -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #4169E1; /* Royal Blue */
        }
        textarea {
            resize: vertical; /* Allow vertical resizing */
            min-height: 80px; /* Minimum height for text areas */
            background-color: #FFFACD; /* Pale Yellow background for text areas */
        }
        /* Style for the scripture text to give it a distinct look */
        .scripture-text {
            font-family: 'Delius', serif; /* A classic, elegant font */
            font-size: 1.25rem; /* Larger text */
            font-weight: 600; /* Semi-bold */
            font-style: italic;
            color: #3b5d46; /* A deep green for a natural feel */
            line-height: 1.6;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        .scripture-reference {
            font-size: 0.9rem;
            color: #6c757d;
            text-align: center;
            font-style: italic;
        }
        /* Custom styling for emoji buttons */
        .emoji-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px; /* Fixed width for consistent grid */
            height: 48px; /* Fixed height for consistent grid */
        }
        /* Custom styling for action step buttons */
        .action-step-button {
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* Pill shape */
            border: 2px solid;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            white-space: nowrap; /* Prevent text from wrapping inside button */
        }
        /* Default unselected state */
        .action-step-button:not(.selected) {
            background-color: #e5e7eb; /* Light gray for unselected */
            border-color: #d1d5db; /* Gray border */
            color: #4b5563; /* Dark gray text */
        }
        .action-step-button:hover:not(.selected) {
            background-color: #d1d5db;
        }

        /* Specific colors for selected states */
        .action-step-button.color-scheme-0 {
            background-color: #a7f3d0; /* Light Green */
            border-color: #10b981; /* Green-600 */
            color: #065f46; /* Green-800 */
        }
        .action-step-button.color-scheme-1 {
            background-color: #bfdbfe; /* Light Blue */
            border-color: #3b82f6; /* Blue-600 */
            color: #1e40af; /* Blue-800 */
        }
        .action-step-button.color-scheme-2 {
            background-color: #fecaca; /* Light Red */
            border-color: #ef4444; /* Red-600 */
            color: #991b1b; /* Red-800 */
        }
        .action-step-button.color-scheme-3 {
            background-color: #fde68a; /* Light Yellow */
            border-color: #f59e0b; /* Yellow-600 */
            color: #92400e; /* Yellow-800 */
        }
        .action-step-button.color-scheme-4 {
            background-color: #e9d5ff; /* Light Purple */
            border-color: #a855f7; /* Purple-600 */
            color: #6b21a8; /* Purple-800 */
        }

        /* Canvas styling */
        #drawingCanvas {
            border: 1px solid #d1d5db;
            background-color: #ffffff;
            cursor: crosshair;
            touch-action: none; /* Prevent browser default touch actions */
        }
        /* Styling for SVG icons within buttons */
        .preset-icon-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px; /* Fixed size for consistency */
            height: 48px;
            border-radius: 0.375rem; /* rounded-md */
            border: 2px solid #d1d5db; /* border-gray-300 */
            background-color: #f9fafb; /* bg-gray-50 */
            transition: all 0.15s ease-in-out;
            cursor: pointer;
        }
        .preset-icon-button:hover {
            background-color: #e5e7eb; /* hover:bg-gray-200 */
        }
        .preset-icon-button.selected {
            background-color: #bfdbfe; /* Light blue background for selected button */
            border-color: #3b82f6; /* Blue border for selected button */
        }
        .preset-icon-button svg {
            width: 80%; /* Make SVG fill the button, slightly smaller */
            height: 80%;
            /* SVG fill colors are now defined directly within the SVG paths */
        }

        /* New style for the reminder text */
        .reminder-text {
            font-family: 'Playfair Display', serif; /* Elegant font */
            font-weight: 700; /* Bold */
            font-style: italic; /* Italic for refinement */
            color: #4b5563; /* Dark gray for visibility against pale yellow box */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-gradient-to-br from-blue-100 to-purple-100 p-8 rounded-lg shadow-xl max-w-2xl w-full space-y-6 border border-gray-200" id="main-content">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-6" id="main-title">üåÖ Morning Reflection</h1>

        <!-- Language Toggle Buttons -->
        <div class="flex justify-end space-x-2 mb-4">
            <button id="lang-en" class="px-4 py-2 rounded-md bg-blue-500 text-white font-semibold hover:bg-blue-600 transition duration-200">English</button>
            <button id="lang-fr" class="px-4 py-2 rounded-md bg-gray-300 text-gray-800 font-semibold hover:bg-gray-400 transition duration-200">Fran√ßais</button>
        </div>

        <!-- Reminder Section - Content will be updated by JavaScript -->
        <div class="text-center mb-4">
            <p class="text-2xl md:text-3xl reminder-text" id="daily-reminder">You are not walking alone. God is lighting the path, even when it curves.</p>
        </div>

        <!-- Date Navigation and Save Button -->
        <div class="flex items-center justify-between bg-gray-100 p-2 rounded-md shadow-sm border border-gray-200">
            <button id="prev-day-btn" class="px-2 py-0.5 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-200 font-semibold text-sm">&lt; Prev Day</button>
            <span id="current-date-display" class="font-bold text-base text-gray-700"></span>
            <button id="next-day-btn" class="px-2 py-0.5 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-200 font-semibold text-sm">Next Day &gt;</button>
            <button id="save-entry-btn" class="ml-3 px-3 py-1.5 bg-green-500 text-white rounded-md hover:bg-green-600 transition duration-200 font-semibold text-sm">Save Entry</button>
        </div>
        <div id="save-status-message" class="text-center text-sm mt-2 text-gray-600"></div>


        <!-- Scripture of the Day Section -->
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                <span class="text-yellow-500 mr-2">üìñ</span> <span id="scripture-title">Scripture of the Day</span>
            </h2>
            <div class="bg-gray-50 p-4 rounded-md border border-gray-200">
                <p class="scripture-text" id="scripture-text"></p>
                <p class="scripture-reference" id="scripture-reference"></p>
            </div>
        </div>

        <!-- Verse Reflection Section -->
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                <span class="text-yellow-500 mr-2">‚ú®</span> <span id="verse-reflection-title">What does this verse mean to me today?</span>
            </h2>
            <textarea
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-200 ease-in-out shadow-sm"
                id="verse-reflection-textarea"
                placeholder="Write your thoughts here"
            ></textarea>
        </div>

        <!-- Personal Prayer Section -->
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                <span class="text-purple-500 mr-2">üôè</span> <span id="personal-prayer-title">Personal Prayer</span>
            </h2>
            <p class="text-gray-600 text-sm" id="personal-prayer-subtitle">Talk to God about your hopes and needs today. Here's a suggestion to inspire you:</p>
            <textarea
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-200 ease-in-out shadow-sm"
                id="prayer-textarea"
                placeholder="Heavenly Father, on this Monday, I come before You seeking strength and guidance. Help me to trust in Your wisdom completely, even when I don't understand Your plan. Guide my steps today and make my path straight according to Your will. Amen."
            ></textarea>
        </div>

        <!-- Spiritual Challenge Section - Placeholder will be updated by JavaScript -->
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                <span class="text-green-500 mr-2">üå±</span> <span id="spiritual-challenge-full-title">Spiritual Challenge of the Day: Trust</span>
            </h2>
            <p class="text-gray-600 text-sm" id="challenge-prompt">Where am I being called to trust God more fully today?</p>
            <textarea
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-200 ease-in-out shadow-sm"
                id="spiritual-challenge-textarea"
                placeholder="Reflect and write here"
            ></textarea>
        </div>

        <!-- Gratitude Prompt Section - Placeholder will be updated by JavaScript -->
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                <span class="text-pink-500 mr-2">üíõ</span> <span id="gratitude-title">Gratitude Prompt</span>
            </h2>
            <p class="text-gray-600 text-sm" id="gratitude-subtitle">Today, I am thankful for...</p>

            <!-- Emoji Picker for Gratitude -->
            <p class="text-gray-600 text-sm mb-2" id="emoji-instructions">Choose up to 4 emojis that represent your gratitude today:</p>
            <div id="emoji-picker-container" class="grid grid-cols-5 gap-2 justify-items-center p-2 bg-gray-50 rounded-md border border-gray-200">
                <!-- Emojis will be dynamically inserted here by JavaScript -->
            </div>
            <div id="selected-emojis-display" class="mt-2 text-3xl text-center">
                <!-- Selected emojis will appear here -->
            </div>

            <textarea
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-200 ease-in-out shadow-sm"
                id="gratitude-textarea"
                placeholder="Write your list here"
            ></textarea>
        </div>

        <!-- Action Step Section - New interactive picker -->
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                <span class="text-red-500 mr-2">üìå</span> <span id="action-step-title">Action Step</span>
            </h2>
            <p class="text-gray-600 text-sm" id="action-step-subtitle">One way I will live out today‚Äôs verse is...</p>

            <p class="text-gray-600 text-sm mb-2" id="action-instructions">Choose up to 4 action steps to focus on today:</p>
            <div id="action-step-picker-container" class="flex flex-wrap gap-2 justify-center p-2 bg-gray-50 rounded-md border border-gray-200">
                <!-- Action steps will be dynamically inserted here by JavaScript -->
            </div>
            <div id="selected-action-steps-display" class="mt-2 text-base text-center font-medium text-gray-700">
                <!-- Selected action steps will appear here -->
            </div>

            <textarea
                class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-400 focus:border-transparent transition duration-200 ease-in-out shadow-sm"
                id="action-step-textarea"
                placeholder="Elaborate on your chosen action steps or write your own here."
            ></textarea>
        </div>

        <!-- Visual Space Section -->
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                <span class="text-blue-500 mr-2">üñº</span> <span id="visual-space-title">Visual Space</span>
            </h2>
            <p class="text-gray-600 text-sm" id="visual-space-subtitle">Sketch, doodle, or paste an image that reflects your morning inspiration.</p>

            <div class="flex flex-col md:flex-row gap-4">
                <!-- Drawing Controls -->
                <div class="flex flex-col p-3 bg-gray-50 rounded-md border border-gray-200 flex-grow">
                    <p class="text-gray-600 text-sm mb-2" id="drawing-tools-title">Drawing Tools:</p>
                    <div class="flex items-center space-x-2 mb-2">
                        <input type="color" id="penColor" value="#000000" class="w-8 h-8 rounded-md border border-gray-300 cursor-pointer">
                        <label for="penColor" class="text-sm text-gray-700" id="pen-color-label">Pen Color</label>
                    </div>
                    <div class="flex items-center space-x-2 mb-4">
                        <input type="range" id="penSize" min="1" max="10" value="2" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <span class="text-sm text-gray-700" id="pen-size-label">Size: <span id="penSizeValue">2</span>px</span>
                    </div>
                    <button id="clearCanvas" class="px-4 py-2 bg-red-500 text-white rounded-md font-semibold hover:bg-red-600 transition duration-200">
                        <span id="clear-canvas-button-text">Clear Canvas</span>
                    </button>
                </div>

                <!-- Preset Icons -->
                <div class="flex flex-col p-3 bg-gray-50 rounded-md border border-gray-200 flex-grow">
                    <p class="text-gray-600 text-sm mb-2" id="preset-icons-title">Preset Icons:</p>
                    <div id="preset-icon-container" class="grid grid-cols-4 gap-2 justify-items-center">
                        <!-- Preset icons will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <canvas id="drawingCanvas" class="w-full h-64 md:h-80 rounded-md shadow-sm"></canvas>
            <p class="text-gray-600 text-sm mt-2 text-center" id="paste-image-info">
                (Note: Pasting images directly from clipboard is not supported in this simple version. Please use drawing tools and preset icons.)
            </p>
        </div>
    </div>

    <script type="module">
        // No Firebase imports needed for local storage

        let currentLanguage = 'en'; // Default language
        let selectedEmojis = []; // Stores the actual emoji characters
        let selectedActionSteps = []; // Stores the actual action step phrases
        let currentDate = new Date(); // Tracks the currently displayed date

        // --- Canvas Drawing Variables ---
        let canvas, ctx;
        let isDrawing = false;
        let drawingActions = []; // Stores drawing commands for saving/loading
        let penColor = '#000000';
        let penSize = 2;
        let activePresetIcon = null; // Stores the SVG string for the currently selected preset icon


        // Define a palette of colors for selected action steps
        const actionStepColorClasses = [
            'color-scheme-0', // Greenish
            'color-scheme-1', // Blueish
            'color-scheme-2', // Reddish
            'color-scheme-3', // Yellowish
            'color-scheme-4'  // Purplish
        ];

        const allEmojis = [
            "üòä", "üíñ", "‚òÄÔ∏è", "üå≥", "üè°", "ü´Ç", "üôè", "üí°", "üíß", "üìö",
            "üé∂", "üé®", "üåü", "üí™", "üçé", "üïäÔ∏è", "üéÅ", "‚ú®", "üåà", "‚òï"
        ];

        // New object to store emoji names in both languages
        const emojiNames = {
            "üòä": { en: "joy", fr: "joie" },
            "üíñ": { en: "love", fr: "amour" },
            "‚òÄÔ∏è": { en: "sun", fr: "soleil" },
            "üå≥": { en: "nature", fr: "nature" },
            "üè°": { en: "home", fr: "maison" },
            "ü´Ç": { en: "community", fr: "communaut√©" },
            "üôè": { en: "prayer", fr: "pri√®re" },
            "üí°": { en: "idea", fr: "id√©e" },
            "üíß": { en: "refreshment", fr: "rafra√Æchissement" },
            "üìö": { en: "learning", fr: "apprentissage" },
            "üé∂": { en: "music", fr: "musique" },
            "üé®": { en: "creativity", fr: "cr√©ativit√©" },
            "üåü": { en: "blessing", fr: "b√©n√©diction" },
            "üí™": { en: "strength", fr: "force" },
            "üçé": { en: "health", fr: "sant√©" },
            "üïäÔ∏è": { en: "peace", fr: "paix" },
            "üéÅ": { en: "gift", fr: "cadeau" },
            "‚ú®": { en: "sparkle", fr: "√©clat" },
            "üåà": { en: "hope", fr: "espoir" },
            "‚òï": { en: "comfort", fr: "confort" }
        };

        const allActionSteps = [
            { en: "Practice active listening", fr: "Pratiquer l'√©coute active" },
            { en: "Offer a genuine compliment", fr: "Faire un compliment sinc√®re" },
            { en: "Spend 15 mins in nature", fr: "Passer 15 min dans la nature" },
            { en: "Write a thank-you note", fr: "√âcrire une note de remerciement" },
            { en: "Help someone without being asked", fr: "Aider quelqu'un sans qu'on le demande" },
            { en: "Meditate for 5 minutes", fr: "M√©diter 5 minutes" },
            { en: "Read an inspiring passage", fr: "Lire un passage inspirant" },
            { en: "Forgive a past grievance", fr: "Pardonner une vieille rancune" },
            { en: "Connect with a loved one", fr: "Prendre contact avec un proche" },
            { en: "Do a small act of service", fr: "Faire un petit acte de service" },
            { en: "Learn something new", fr: "Apprendre quelque chose de nouveau" },
            { en: "Express gratitude verbally", fr: "Exprimer sa gratitude verbalement" },
            { en: "Take a mindful break", fr: "Faire une pause consciente" },
            { en: "Let go of control", fr: "L√¢cher prise sur le contr√¥le" },
            { en: "Share a smile with a stranger", fr: "Partager un sourire avec un inconnu" }
        ];

        // Updated: Preset icons for Visual Space - now with intrinsic colors in SVGs
        const presetIcons = [
            // Weather Icons (similar to image_e570ba.png)
            { name: { en: "Sunny", fr: "Ensoleill√©" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><linearGradient id="sunGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFD700"/><stop offset="100%" stop-color="#FFA500"/></linearGradient></defs><circle cx="12" cy="12" r="6" fill="url(#sunGrad)"/><path d="M12 2v2m0 16v2m8-10h2M2 12h2m14.364-7.364l-1.414 1.414M6.05 17.95l-1.414 1.414M17.95 6.05l1.414-1.414M6.05 6.05L4.636 4.636" stroke="#FF8C00" stroke-width="1.5" stroke-linecap="round"/></svg>' },
            { name: { en: "Partly Cloudy", fr: "Partiellement Nuageux" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><linearGradient id="partlyCloudySunGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFD700"/><stop offset="100%" stop-color="#FFA500"/></linearGradient></defs><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-3.72 0-6.83 2.81-7.35 6.41C2.57 11.49 1 13.68 1 16c0 3.31 2.69 6 6 6h11c3.87 0 7-3.13 7-7 0-3.59-2.65-6.54-6.09-6.96z" fill="#D3D3D3"/><circle cx="17" cy="7" r="3" fill="url(#partlyCloudySunGrad)"/></svg>' },
            { name: { en: "Cloudy", fr: "Nuageux" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-3.72 0-6.83 2.81-7.35 6.41C2.57 11.49 1 13.68 1 16c0 3.31 2.69 6 6 6h11c3.87 0 7-3.13 7-7 0-3.59-2.65-6.54-6.09-6.96z" fill="#D3D3D3"/></svg>' },
            { name: { en: "Rainy", fr: "Pluvieux" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-3.72 0-6.83 2.81-7.35 6.41C2.57 11.49 1 13.68 1 16c0 3.31 2.69 6 6 6h11c3.87 0 7-3.13 7-7 0-3.59-2.65-6.54-6.09-6.96z" fill="#D3D3D3"/><path d="M12 18v3m-3-3v3m6-3v3" stroke="#4682B4" stroke-width="2" stroke-linecap="round"/></svg>' },
            { name: { en: "Stormy", fr: "Orageux" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-3.72 0-6.83 2.81-7.35 6.41C2.57 11.49 1 13.68 1 16c0 3.31 2.69 6 6 6h11c3.87 0 7-3.13 7-7 0-3.59-2.65-6.54-6.09-6.96z" fill="#808080"/><path d="M15 14h-3l-2 5h2l-3 5h2l-2 5z" fill="#FFD700"/></svg>' },
            { name: { en: "Snowy", fr: "Neigeux" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4c-3.72 0-6.83 2.81-7.35 6.41C2.57 11.49 1 13.68 1 16c0 3.31 2.69 6 6 6h11c3.87 0 7-3.13 7-7 0-3.59-2.65-6.54-6.09-6.96z" fill="#D3D3D3"/><path d="M12 18.5v1.5m-1.5-1.5l1.5 1.5m1.5-1.5l-1.5 1.5M8 18.5v1.5m-1.5-1.5l1.5 1.5m1.5-1.5l-1.5 1.5M16 18.5v1.5m-1.5-1.5l1.5 1.5m1.5-1.5l-1.5 1.5" stroke="#ADD8E6" stroke-width="2" stroke-linecap="round"/></svg>' },
            { name: { en: "Windy", fr: "Venteux" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 12h14M7 15l-2 2M17 15l2 2" stroke="#B0C4DE" stroke-width="2" stroke-linecap="round"/><path d="M4 10a3 3 0 110 6h16a3 3 0 110-6H4z" fill="#B0C4DE"/></svg>' },
            { name: { en: "Night (Moon)", fr: "Nuit (Lune)" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.12-1.36a5.5 5.5 0 01-1.84-8.88C19.1 3.51 15.7 2 12 2z" fill="#FFD700"/><circle cx="18" cy="6" r="1.5" fill="#FFFFFF"/><circle cx="15" cy="3" r="1" fill="#FFFFFF"/><circle cx="21" cy="10" r="1" fill="#FFFFFF"/></svg>' },

            // Season Icons (similar to image_e56cdc.png)
            { name: { en: "Summer", fr: "√ât√©" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><linearGradient id="summerSunGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFC107"/><stop offset="100%" stop-color="#FF8F00"/></linearGradient></defs><circle cx="12" cy="12" r="6" fill="url(#summerSunGrad)"/><path d="M12 2v2m0 16v2m8-10h2M2 12h2m14.364-7.364l-1.414 1.414M6.05 17.95l-1.414 1.414M17.95 6.05l1.414-1.414M6.05 6.05L4.636 4.636" stroke="#FF8F00" stroke-width="1.5" stroke-linecap="round"/></svg>' },
            { name: { en: "Spring", fr: "Printemps" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4" fill="#9CCC65"/><path d="M12 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="#FF69B4" stroke="#C2185B" stroke-width="1.5"/></svg>' },
            { name: { en: "Autumn", fr: "Automne" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.41 6.59c-.39-.39-1.02-.39-1.41 0L12 10.59 8.01 6.59c-.39-.39-1.02-.39-1.41 0s-.39 1.02 0 1.41L10.59 12 6.59 15.99c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L12 13.41l3.99 3.99c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L13.41 12l3.99-3.99c.39-.39.39-1.02 0-1.41z" fill="#FFA500" stroke="#E65100" stroke-width="1.5"/><path d="M12 13.41l-1.5-1.5-1.5 1.5-1.5-1.5-1.5 1.5-1.5-1.5L6.59 12 12 6.59 17.41 12 12 17.41z" fill="#D2691E"/></svg>' },
            { name: { en: "Winter", fr: "Hiver" }, svg: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM12 8a4 4 0 100 8 4 4 0 000-8z" fill="#ADD8E6" stroke="#64B5F6" stroke-width="1.5"/><path d="M12 8v8m-4-4h8m-4-4l2 4m-2 0l-2-4" stroke="#64B5F6" stroke-width="1.5" stroke-linecap="round"/></svg>' }
        ];


        const content = {
            "en": {
                mainTitle: "üåÖ Morning Reflection",
                reminderPrefix: "",
                scriptureTitle: "Scripture of the Day",
                verseReflectionTitle: "What does this verse mean to me today?",
                verseReflectionPlaceholder: "Write your thoughts here",
                personalPrayerTitle: "Personal Prayer",
                personalPrayerSubtitle: "Talk to God about your hopes and needs today. Here's a suggestion to inspire you:",
                gratitudeTitle: "Gratitude Prompt",
                gratitudeSubtitle: "Today, I am thankful for...",
                emojiInstructions: "Choose up to 4 emojis that represent your gratitude today:",
                gratitudePlaceholder: "Write your list here",
                actionStepTitle: "Action Step",
                actionStepSubtitle: "One way I will live out today‚Äôs verse is...",
                actionInstructions: "Choose up to 4 action steps to focus on today:",
                actionStepPlaceholder: "Elaborate on your chosen action steps or write your own here.",
                visualSpaceTitle: "Visual Space",
                visualSpaceSubtitle: "Sketch, doodle, or paste an image that reflects your morning inspiration.",
                drawingToolsTitle: "Drawing Tools:",
                penColorLabel: "Pen Color",
                penSizeLabel: "Size:",
                clearCanvasButtonText: "Clear Canvas",
                presetIconsTitle: "Preset Icons:",
                pasteImageInfo: "(Note: Pasting images directly from clipboard is not supported in this simple version. Click an icon, then click the canvas to stamp it.)",
                dailyContent: [
                    // Day 1
                    {
                        scripture: { text: "Trust in the Lord with all your heart and lean not on your own understanding; in all your ways submit to Him, and He will make your paths straight.", reference: "Proverbs 3:5-6" },
                        reminder: "You are not walking alone. God is lighting the path, even when it curves.",
                        spiritualChallengeTheme: "Strength & Guidance",
                        spiritualChallengePrompt: "Consider a specific area where you tend to rely on your own understanding. How can you intentionally surrender that to God today?"
                    },
                    // Day 2
                    {
                        scripture: { text: "The Lord is my light and my salvation‚Äîwhom shall I fear? The Lord is the stronghold of my life‚Äîof whom shall I be afraid?", reference: "Psalm 27:1" },
                        reminder: "Peace isn‚Äôt the absence of fear‚Äîit‚Äôs the presence of God.",
                        spiritualChallengeTheme: "Peace & Comfort",
                        spiritualChallengePrompt: "Identify a situation causing you anxiety. How can you invite God's peace into it?"
                    },
                    // Day 3
                    {
                        scripture: { text: "But those who hope in the Lord will renew their strength. They will soar on wings like eagles; they will run and not grow weary, they will walk and not be faint.", reference: "Isaiah 40:31" },
                        reminder: "Waiting isn‚Äôt wasting‚Äîit‚Äôs preparing.",
                        spiritualChallengeTheme: "Patience & Perspective",
                        spiritualChallengePrompt: "What is one area where you need to release control and trust God's timing?"
                    },
                    // Day 4
                    {
                        scripture: { text: "Create in me a pure heart, O God, and renew a steadfast spirit within me.", reference: "Psalm 51:10" },
                        reminder: "Renewal begins with release.",
                        spiritualChallengeTheme: "Forgiveness & Renewal",
                        spiritualChallengePrompt: "Is there anyone you need to forgive, or an area where you need God's forgiveness and renewal?"
                    },
                    // Day 5
                    {
                        scripture: { text: "Be kind and compassionate to one another, forgiving each other, just as in Christ God forgave you.", reference: "Ephesians 4:32" },
                        reminder: "Every act of compassion is a reflection of God‚Äôs love.",
                        spiritualChallengeTheme: "Love & Compassion",
                        spiritualChallengePrompt: "How can you show intentional kindness or compassion to someone today?"
                    },
                    // Day 6
                    {
                        scripture: { text: "Come to me, all you who are weary and burdened, and I will give you rest.", reference: "Matthew 11:28" },
                        reminder: "Let go. Breathe. Rest. God is still working while you sleep.",
                        spiritualChallengeTheme: "Rest & Surrender",
                        spiritualChallengePrompt: "What burden can you intentionally surrender to God today to find rest?"
                    },
                    // Day 7
                    {
                        scripture: { text: "This is the day that the Lord has made; let us rejoice and be glad in it.", reference: "Psalm 118:24" },
                        reminder: "Joy is not merely an emotion; it's a spiritual choice.",
                        spiritualChallengeTheme: "Joy & Worship",
                        spiritualChallengePrompt: "How can you intentionally cultivate joy and express worship today?"
                    },
                    // Day 8
                    {
                        scripture: { text: "I can do all things through Christ who strengthens me.", reference: "Philippians 4:13" },
                        reminder: "Your strength comes from Him. Lean on it.",
                        spiritualChallengeTheme: "Inner Strength",
                        spiritualChallengePrompt: "Where do you feel weak today? How can you invite Christ's strength into that area?"
                    },
                    // Day 9
                    {
                        scripture: { text: "For I know the plans I have for you,‚Äù declares the Lord, ‚Äúplans to prosper you and not to harm you, plans to give you hope and a future.", reference: "Jeremiah 29:11" },
                        reminder: "God's plans for you are good, even when the path is unclear.",
                        spiritualChallengeTheme: "Hope & Future",
                        spiritualChallengePrompt: "What future hope are you holding onto? How does this verse encourage you?"
                    },
                    // Day 10
                    {
                        scripture: { text: "The steadfast love of the Lord never ceases; His mercies never come to an end; they are new every morning; great is Your faithfulness.", reference: "Lamentations 3:22-23" },
                        reminder: "Every new day brings new mercies. Embrace them.",
                        spiritualChallengeTheme: "Mercy & Faithfulness",
                        spiritualChallengePrompt: "What new mercy can you recognize and be thankful for this morning?"
                    },
                    // Day 11
                    {
                        scripture: { text: "Be still, and know that I am God; I will be exalted among the nations, I will be exalted in the earth.", reference: "Psalm 46:10" },
                        reminder: "In stillness, you find God's presence and power.",
                        spiritualChallengeTheme: "Stillness & Presence",
                        spiritualChallengePrompt: "How can you create a moment of stillness today to connect with God?"
                    },
                    // Day 12
                    {
                        scripture: { text: "For where two or three gather in my name, there am I among them.", reference: "Matthew 18:20" },
                        reminder: "God is with you, especially when you gather in His name.",
                        spiritualChallengeTheme: "Community & Presence",
                        spiritualChallengePrompt: "How can you foster a sense of God's presence in your interactions with others today?"
                    },
                    // Day 13
                    {
                        scripture: { text: "The Lord bless you and keep you; the Lord make His face shine upon you and be gracious to you; the Lord lift up His countenance upon you and give you peace.", reference: "Numbers 6:24-26" },
                        reminder: "You are blessed, kept, and graced by the Lord.",
                        spiritualChallengeTheme: "Blessing & Peace",
                        spiritualChallengePrompt: "Reflect on a blessing you've received. How can you share that peace with someone else?"
                    },
                    // Day 14
                    {
                        scripture: { text: "But seek first His kingdom and His righteousness, and all these things will be given to you as well.", reference: "Matthew 6:33" },
                        reminder: "Prioritize God, and everything else will fall into place.",
                        spiritualChallengeTheme: "Priorities & Provision",
                        spiritualChallengePrompt: "What is one thing you can prioritize today to seek God's kingdom first?"
                    },
                    // Day 15
                    {
                        scripture: { text: "A new command I give you: Love one another. As I have loved you, so you must love one another.", reference: "John 13:34" },
                        reminder: "Love is an action, a daily choice.",
                        spiritualChallengeTheme: "Love in Action",
                        spiritualChallengePrompt: "How can you actively demonstrate love to someone in your life today?"
                    },
                    // Day 16
                    {
                        scripture: { text: "Be joyful in hope, patient in affliction, faithful in prayer.", reference: "Romans 12:12" },
                        reminder: "Hope fuels joy, patience strengthens resolve, prayer connects you to power.",
                        spiritualChallengeTheme: "Joy, Patience, Prayer",
                        spiritualChallengePrompt: "Which of these three areas (hope, patience, prayer) needs your focus today?"
                    },
                    // Day 17
                    {
                        scripture: { text: "For God did not give us a spirit of timidity, but a spirit of power, of love and of a sound mind.", reference: "2 Timothy 1:7" },
                        reminder: "You are equipped with power, love, and a sound mind.",
                        spiritualChallengeTheme: "Courage & Clarity",
                        spiritualChallengePrompt: "Where do you need to step out in power, love, or a sound mind today?"
                    },
                    // Day 18
                    {
                        scripture: { text: "The Lord is good, a stronghold in the day of trouble; He knows those who take refuge in Him.", reference: "Nahum 1:7" },
                        reminder: "In times of trouble, God is your safe refuge.",
                        spiritualChallengeTheme: "Refuge & Safety",
                        spiritualChallengePrompt: "What troubles are you facing? How can you find refuge in God today?"
                    },
                    // Day 19
                    {
                        scripture: { text: "I have told you these things, so that in me you may have peace. In this world you will have trouble. But take heart! I have overcome the world.", reference: "John 16:33" },
                        reminder: "Troubles are inevitable, but peace is possible through Christ.",
                        spiritualChallengeTheme: "Overcoming Trouble",
                        spiritualChallengePrompt: "What challenge feels overwhelming? How can you find peace in Christ's victory?"
                    },
                    // Day 20
                    {
                        scripture: { text: "And we know that in all things God works for the good of those who love Him, who have been called according to His purpose.", reference: "Romans 8:28" },
                        reminder: "Even in difficult circumstances, God is working for your good.",
                        spiritualChallengeTheme: "Purpose & Goodness",
                        spiritualChallengePrompt: "How can you see God's purpose unfolding even in unexpected situations today?"
                    },
                    // Day 21
                    {
                        scripture: { text: "The fruit of the Spirit is love, joy, peace, forbearance, kindness, goodness, faithfulness, gentleness and self-control.", reference: "Galatians 5:22-23" },
                        reminder: "Cultivate these fruits, and your life will flourish.",
                        spiritualChallengeTheme: "Spiritual Fruit",
                        spiritualChallengePrompt: "Which fruit of the Spirit do you want to intentionally grow today?"
                    },
                    // Day 22
                    {
                        scripture: { text: "Do not be anxious about anything, but in every situation, by prayer and petition, with thanksgiving, present your requests to God.", reference: "Philippians 4:6" },
                        reminder: "Trade your anxiety for prayer and thanksgiving.",
                        spiritualChallengeTheme: "Anxiety & Prayer",
                        spiritualChallengePrompt: "What anxiety can you turn into a prayer of thanksgiving today?"
                    },
                    // Day 23
                    {
                        scripture: { text: "For it is by grace you have been saved, through faith‚Äîand this is not from yourselves, it is the gift of God‚Äî", reference: "Ephesians 2:8" },
                        reminder: "Salvation is a gift, freely given by grace.",
                        spiritualChallengeTheme: "Grace & Faith",
                        spiritualChallengePrompt: "How can you live out your gratitude for God's grace today?"
                    },
                    // Day 24
                    {
                        scripture: { text: "I praise you because I am fearfully and wonderfully made; your works are wonderful, I know that full well.", reference: "Psalm 139:14" },
                        reminder: "You are a masterpiece, wonderfully made by God.",
                        spiritualChallengeTheme: "Self-Worth & Creation",
                        spiritualChallengePrompt: "How can you affirm your unique value as God's creation today?"
                    },
                    // Day 25
                    {
                        scripture: { text: "The Lord is my shepherd; I shall not want.", reference: "Psalm 23:1" },
                        reminder: "With God as your shepherd, all your needs are met.",
                        spiritualChallengeTheme: "Provision & Contentment",
                        spiritualChallengePrompt: "What need can you trust God to provide for today?"
                    },
                    // Day 26
                    {
                        scripture: { text: "Therefore, if anyone is in Christ, the new creation has come: The old has gone, the new is here!", reference: "2 Corinthians 5:17" },
                        reminder: "Embrace the newness that Christ offers you daily.",
                        spiritualChallengeTheme: "New Beginnings",
                        spiritualChallengePrompt: "What 'old' habit or mindset can you leave behind today to embrace the 'new'?"
                    },
                    // Day 27
                    {
                        scripture: { text: "For God so loved the world that He gave His one and only Son, that whoever believes in Him shall not perish but have eternal life.", reference: "John 3:16" },
                        reminder: "God's love is boundless, offering eternal life.",
                        spiritualChallengeTheme: "Divine Love",
                        spiritualChallengePrompt: "How can you reflect God's boundless love to someone else today?"
                    },
                    // Day 28
                    {
                        scripture: { text: "The joy of the Lord is your strength.", reference: "Nehemiah 8:10" },
                        reminder: "Find your strength not in circumstances, but in the joy of the Lord.",
                        spiritualChallengeTheme: "Joy as Strength",
                        spiritualChallengePrompt: "How can you tap into the joy of the Lord to find strength for today's tasks?"
                    },
                    // Day 29
                    {
                        scripture: { text: "And surely I am with you always, to the very end of the age.", reference: "Matthew 28:20" },
                        reminder: "You are never alone; God's presence is constant.",
                        spiritualChallengeTheme: "Constant Presence",
                        spiritualChallengePrompt: "How can you be more aware of God's constant presence with you today?"
                    },
                    // Day 30
                    {
                        scripture: { text: "Whatever you do, work at it with all your heart, as working for the Lord, not for human masters.", reference: "Colossians 3:23" },
                        reminder: "Every task, big or small, can be an act of worship.",
                        spiritualChallengeTheme: "Work & Purpose",
                        spiritualChallengePrompt: "How can you approach your work or daily tasks with a renewed sense of purpose for God's glory?"
                    }
                ],
                weeklyPrayerSuggestions: [
                    // Week 1
                    "Heavenly Father, as I begin this week, I pray for Your wisdom to guide my decisions and Your strength to carry out my tasks. Help me to trust in Your perfect plan, even when the path is unclear. May Your presence be my constant companion. Amen.",
                    // Week 2
                    "Lord, I come before You this week seeking Your peace amidst any anxieties. Be my light and my stronghold. Grant me courage to face challenges and the grace to rest in Your unfailing love. May Your comfort fill my heart. Amen.",
                    // Week 3
                    "Gracious God, I pray for renewed strength and fresh perspective as I move through this week. Help me to hope in You, knowing that You will lift me up and enable me to overcome weariness. Grant me the patience to wait on Your timing and to see Your hand in all things. Amen.",
                    // Week 4
                    "Merciful Father, this week I seek Your forgiveness and renewal. Cleanse my heart and renew a steadfast spirit within me. Help me to walk in integrity, to extend compassion to others, and to reflect Your boundless love in all I do. Amen."
                ]
            },
            "fr": {
                mainTitle: "üåÖ R√©flexion Matinale",
                reminderPrefix: "",
                scriptureTitle: "√âcriture du Jour",
                verseReflectionTitle: "Que signifie ce verset pour moi aujourd'sui ?",
                verseReflectionPlaceholder: "√âcrivez vos pens√©es ici",
                personalPrayerTitle: "Pri√®re Personnelle",
                personalPrayerSubtitle: "Parlez √† Dieu de vos espoirs et de vos besoins aujourd'hui. Voici une suggestion pour vous inspirer :",
                gratitudeTitle: "Invite √† la Gratitude",
                gratitudeSubtitle: "Aujourd'hui, je suis reconnaissant(e) pour...",
                emojiInstructions: "Choisissez jusqu'√† 4 √©mojis qui repr√©sentent votre gratitude aujourd'hui :",
                gratitudePlaceholder: "√âcrivez votre liste ici",
                actionStepTitle: "√âtape d'Action",
                actionStepSubtitle: "Une fa√ßon de vivre le verset d'aujourd'hui est...",
                actionInstructions: "Choisissez jusqu'√† 4 √©tapes d'action sur lesquelles vous concentrer aujourd'hui :",
                actionStepPlaceholder: "√âlaborez sur vos √©tapes d'action choisies ou √©crivez les v√¥tres ici.",
                visualSpaceTitle: "Espace Visuel",
                visualSpaceSubtitle: "Dessinez, gribouillez ou collez une image qui refl√®te votre inspiration matinale.",
                drawingToolsTitle: "Outils de Dessin :",
                penColorLabel: "Couleur du Stylo",
                penSizeLabel: "Taille :",
                clearCanvasButtonText: "Effacer le Canevas",
                presetIconsTitle: "Ic√¥nes Pr√©d√©finies :",
                pasteImageInfo: "(Note : Le collage d'images directement depuis le presse-papiers n'est pas pris en charge dans cette version simple. Cliquez sur une ic√¥ne, puis sur le canevas pour l'estampiller.)",
                dailyContent: [
                    // Jour 1
                    {
                        scripture: { text: "Confie-toi en l'√âternel de tout ton c≈ìur, et ne t'appuie pas sur ta sagesse; reconnais-le dans toutes tes voies, et il aplanira tes sentiers.", reference: "Proverbes 3:5-6" },
                        reminder: "Vous ne marchez pas seul. Dieu √©claire le chemin, m√™me quand il tourne.",
                        spiritualChallengeTheme: "Force et Direction",
                        spiritualChallengePrompt: "Consid√©rez un domaine sp√©cifique o√π vous avez tendance √† vous fier √† votre propre compr√©hension. Comment pouvez-vous intentionnellement abandonner cela √† Dieu aujourd'hui ?"
                    },
                    // Jour 2
                    {
                        scripture: { text: "L'√âternel est ma lumi√®re et mon salut : de qui aurais-je crainte ? L'√âternel est le soutien de ma vie : de qui aurais-je peur ?", reference: "Psaume 27:1" },
                        reminder: "La paix n'est pas l'absence de peur, c'est la pr√©sence de Dieu.",
                        spiritualChallengeTheme: "Paix et R√©confort",
                        spiritualChallengePrompt: "Identifiez une situation qui vous cause de l'anxi√©t√©. Comment pouvez-vous y inviter la paix de Dieu ?"
                    },
                    // Jour 3
                    {
                        scripture: { text: "Mais ceux qui s'attendent √† l'√âternel renouvellent leur force. Ils prennent le vol comme les aigles; ils courent et ne se lassent point, ils marchent et ne se fatiguent point.", reference: "√âsa√Øe 40:31" },
                        reminder: "Attendre n'est pas perdre son temps, c'est se pr√©parer.",
                        spiritualChallengeTheme: "Patience et Perspective",
                        spiritualChallengePrompt: "Quel est un domaine o√π vous devez l√¢cher prise et faire confiance au timing de Dieu ?"
                    },
                    // Jour 4
                    {
                        scripture: { text: "√î Dieu ! cr√©e en moi un c≈ìur pur, et renouvelle en moi un esprit bien dispos√©.", reference: "Psaume 51:10" },
                        reminder: "Le renouveau commence par le l√¢cher-prise.",
                        spiritualChallengeTheme: "Pardon et Renouveau",
                        spiritualChallengePrompt: "Y a-t-il quelqu'un que vous devez pardonner, ou un domaine o√π vous avez besoin du pardon et du renouveau de Dieu ?"
                    },
                    // Jour 5
                    {
                        scripture: { text: "Soyez bons les uns envers les autres, compatissants, vous pardonnant r√©ciproquement, comme Dieu vous a pardonn√© en Christ.", reference: "√âph√©siens 4:32" },
                        reminder: "Chaque acte de compassion est un reflet de l'amour de Dieu.",
                        spiritualChallengeTheme: "Amour et Compassion",
                        spiritualChallengePrompt: "Comment pouvez-vous faire preuve de gentillesse ou de compassion intentionnelle envers quelqu'un aujourd'hui ?"
                    },
                    // Jour 6
                    {
                        scripture: { text: "Venez √† moi, vous tous qui √™tes fatigu√©s et charg√©s, et je vous donnerai du repos.", reference: "Matthieu 11:28" },
                        reminder: "L√¢chez prise. Respirez. Reposez-vous. Dieu travaille toujours pendant que vous dormez.",
                        spiritualChallengeTheme: "Repos et Abandon",
                        spiritualChallengePrompt: "Quel fardeau pouvez-vous intentionnellement abandonner √† Dieu aujourd'hui pour trouver le repos ?"
                    },
                    // Jour 7
                    {
                        scripture: { text: "C'est ici la journ√©e que l'√âternel a faite : Qu'elle soit pour nous un sujet d'all√©gresse et de joie !", reference: "Psaume 118:24" },
                        reminder: "La joie n'est pas seulement une √©motion; c'est un choix spirituel.",
                        spiritualChallengeTheme: "Joie et Adoration",
                        spiritualChallengePrompt: "Comment pouvez-vous intentionnellement cultiver la joie et exprimer l'adoration aujourd'hui ?"
                    },
                    // Jour 8
                    {
                        scripture: { text: "Je puis tout par celui qui me fortifie.", reference: "Philippiens 4:13" },
                        reminder: "Votre force vient de Lui. Appuyez-vous sur elle.",
                        spiritualChallengeTheme: "Force Int√©rieure",
                        spiritualChallengePrompt: "O√π vous sentez-vous faible aujourd'hui ? Comment pouvez-vous inviter la force du Christ dans ce domaine ?"
                    },
                    // Jour 9
                    {
                        scripture: { text: "Car je connais les projets que j'ai form√©s sur vous, dit l'√âternel, projets de paix et non de malheur, afin de vous donner un avenir et de l'esp√©rance.", reference: "J√©r√©mie 29:11" },
                        reminder: "Les plans de Dieu pour vous sont bons, m√™me lorsque le chemin n'est pas clair.",
                        spiritualChallengeTheme: "Espoir et Avenir",
                        spiritualChallengePrompt: "√Ä quel espoir futur vous accrochez-vous ? Comment ce verset vous encourage-t-il ?"
                    },
                    // Jour 10
                    {
                        scripture: { text: "Les bont√©s de l'√âternel ne sont pas √©puis√©es, ses compassions ne sont pas √† leur terme; elles se renouvellent chaque matin. Grande est ta fid√©lit√© !", reference: "Lamentations 3:22-23" },
                        reminder: "Chaque nouveau jour apporte de nouvelles mis√©ricordes. Accueillez-les.",
                        spiritualChallengeTheme: "Mis√©ricorde et Fid√©lit√©",
                        spiritualChallengePrompt: "Quelle nouvelle mis√©ricorde pouvez-vous reconna√Ætre et pour laquelle vous pouvez √™tre reconnaissant ce matin ?"
                    },
                    // Jour 11
                    {
                        scripture: { text: "Arr√™tez, et sachez que je suis Dieu : Je domine sur les nations, je domine sur la terre.", reference: "Psaume 46:10" },
                        reminder: "Dans le calme, vous trouvez la pr√©sence et la puissance de Dieu.",
                        spiritualChallengeTheme: "Calme et Pr√©sence",
                        spiritualChallengePrompt: "Comment pouvez-vous cr√©er un moment de calme aujourd'hui pour vous connecter √† Dieu ?"
                    },
                    // Jour 12
                    {
                        scripture: { text: "Car l√† o√π deux ou trois sont assembl√©s en mon nom, je suis au milieu d'eux.", reference: "Matthieu 18:20" },
                        reminder: "Dieu est avec vous, surtout lorsque vous vous rassemblez en Son nom.",
                        spiritualChallengeTheme: "Communaut√© et Pr√©sence",
                        spiritualChallengePrompt: "Comment pouvez-vous favoriser un sentiment de la pr√©sence de Dieu dans vos interactions avec les autres aujourd'hui ?"
                    },
                    // Jour 13
                    {
                        scripture: { text: "Que l'√âternel te b√©nisse et te garde ! Que l'√âternel fasse luire sa face sur toi et t'accorde sa gr√¢ce ! Que l'√âternel tourne sa face vers toi et te donne la paix !", reference: "Nombres 6:24-26" },
                        reminder: "Vous √™tes b√©ni, gard√© et graci√© par l'√âternel.",
                        spiritualChallengeTheme: "B√©n√©diction et Paix",
                        spiritualChallengePrompt: "R√©fl√©chissez √† une b√©n√©diction que vous avez re√ßue. Comment pouvez-vous partager cette paix avec quelqu'un d'autre ?"
                    },
                    // Jour 14
                    {
                        scripture: { text: "Cherchez premi√®rement le royaume et la justice de Dieu; et toutes ces choses vous seront donn√©es par-dessus.", reference: "Matthieu 6:33" },
                        reminder: "Priorisez Dieu, et tout le reste se mettra en place.",
                        spiritualChallengeTheme: "Priorit√©s et Provision",
                        spiritualChallengePrompt: "Quelle est la chose que vous pouvez prioriser aujourd'hui pour chercher d'abord le royaume de Dieu ?"
                    },
                    // Jour 15
                    {
                        scripture: { text: "Je vous donne un commandement nouveau: Aimez-vous les uns les autres; comme je vous ai aim√©s, vous aussi, aimez-vous les uns les autres.", reference: "Jean 13:34" },
                        reminder: "L'amour est une action, un choix quotidien.",
                        spiritualChallengeTheme: "Amour en Action",
                        spiritualChallengePrompt: "Comment pouvez-vous activement d√©montrer de l'amour √† quelqu'un dans votre vie aujourd'hui ?"
                    },
                    // Jour 16
                    {
                        scripture: { text: "Soyez joyeux dans l'esp√©rance, patients dans l'affliction, pers√©v√©rants dans la pri√®re.", reference: "Romains 12:12" },
                        reminder: "L'esp√©rance alimente la joie, la patience renforce la d√©termination, la pri√®re vous connecte √† la puissance.",
                        spiritualChallengeTheme: "Joie, Patience, Pri√®re",
                        spiritualChallengePrompt: "Lequel de ces trois domaines (esp√©rance, patience, pri√®re) a besoin de votre attention aujourd'hui ?"
                    },
                    // Jour 17
                    {
                        scripture: { text: "Car ce n'est pas un esprit de timidit√© que Dieu nous a donn√©, mais un esprit de force, d'amour et de sagesse.", reference: "2 Timoth√©e 1:7" },
                        reminder: "Vous √™tes √©quip√© de puissance, d'amour et d'un esprit sain.",
                        spiritualChallengeTheme: "Courage et Clart√©",
                        spiritualChallengePrompt: "O√π devez-vous agir avec puissance, amour ou un esprit sain aujourd'hui ?"
                    },
                    // Jour 18
                    {
                        scripture: { text: "L'√âternel est bon, il est un refuge au jour de la d√©tresse; il conna√Æt ceux qui se confient en lui.", reference: "Nahum 1:7" },
                        reminder: "Dans les moments difficiles, Dieu est votre refuge s√ªr.",
                        spiritualChallengeTheme: "Refuge et S√©curit√©",
                        spiritualChallengePrompt: "Quels probl√®mes rencontrez-vous ? Comment pouvez-vous trouver refuge en Dieu aujourd'hui ?"
                    },
                    // Jour 19
                    {
                        scripture: { text: "Je vous ai dit ces choses, afin que vous ayez la paix en moi. Dans le monde, vous aurez des tribulations. Mais prenez courage, j'ai vaincu le monde.", reference: "Jean 16:33" },
                        reminder: "Les troubles sont in√©vitables, mais la paix est possible par le Christ.",
                        spiritualChallengeTheme: "Vaincre le Trouble",
                        spiritualChallengePrompt: "Quel d√©fi vous semble insurmontable ? Comment pouvez-vous trouver la paix dans la victoire du Christ ?"
                    },
                    // Jour 20
                    {
                        scripture: { text: "Nous savons, du reste, que toutes choses concourent au bien de ceux qui aiment Dieu, de ceux qui sont appel√©s selon son dessein.", reference: "Romains 8:28" },
                        reminder: "M√™me dans des circonstances difficiles, Dieu ≈ìuvre pour votre bien.",
                        spiritualChallengeTheme: "But et Bont√©",
                        spiritualChallengePrompt: "Comment pouvez-vous voir le dessein de Dieu se d√©rouler m√™me dans des situations inattendues aujourd'hui ?"
                    },
                    // Jour 21
                    {
                        scripture: { text: "Mais le fruit de l'Esprit, c'est l'amour, la joie, la paix, la patience, la bont√©, la bienveillance, la fid√©lit√©, la douceur, la ma√Ætrise de soi.", reference: "Galates 5:22-23" },
                        reminder: "Cultivez ces fruits, et votre vie fleurira.",
                        spiritualChallengeTheme: "Fruit Spirituel",
                        spiritualChallengePrompt: "Quel fruit de l'Esprit voulez-vous intentionnellement cultiver aujourd'hui ?"
                    },
                    // Jour 22
                    {
                        scripture: { text: "Ne vous inqui√©tez de rien; mais en toute chose faites conna√Ætre vos besoins √† Dieu par des pri√®res et des supplications, avec des actions de gr√¢ces.", reference: "Philippiens 4:6" },
                        reminder: "√âchangez votre anxi√©t√© contre la pri√®re et l'action de gr√¢ce.",
                        spiritualChallengeTheme: "Anxi√©t√© et Pri√®re",
                        spiritualChallengePrompt: "Quelle anxi√©t√© pouvez-vous transformer en pri√®re d'action de gr√¢ce aujourd'hui ?"
                    },
                    // Jour 23
                    {
                        scripture: { text: "Car c'est par la gr√¢ce que vous √™tes sauv√©s, par le moyen de la foi. Et cela ne vient pas de vous, c'est le don de Dieu.", reference: "√âph√©siens 2:8" },
                        reminder: "Le salut est un don, donn√© gratuitement par gr√¢ce.",
                        spiritualChallengeTheme: "Gr√¢ce et Foi",
                        spiritualChallengePrompt: "Comment pouvez-vous vivre votre gratitude pour la gr√¢ce de Dieu aujourd'hui ?"
                    },
                    // Jour 24
                    {
                        scripture: { text: "Je te loue de ce que je suis une cr√©ature si merveilleuse. Tes ≈ìuvres sont admirables, et mon √¢me le reconna√Æt bien.", reference: "Psaume 139:14" },
                        reminder: "Vous √™tes un chef-d'≈ìuvre, merveilleusement cr√©√© par Dieu.",
                        spiritualChallengeTheme: "Estime de Soi et Cr√©ation",
                        spiritualChallengePrompt: "Comment pouvez-vous affirmer votre valeur unique en tant que cr√©ation de Dieu aujourd'hui ?"
                    },
                    // Jour 25
                    {
                        scripture: { text: "L'√âternel est mon berger : je ne manquerai de rien.", reference: "Psaume 23:1" },
                        reminder: "Avec Dieu comme votre berger, tous vos besoins sont satisfaits.",
                        spiritualChallengeTheme: "Provision et Contentement",
                        spiritualChallengePrompt: "Quel besoin pouvez-vous confier √† Dieu aujourd'hui pour qu'il le satisfasse ?"
                    },
                    // Jour 26
                    {
                        scripture: { text: "Si quelqu'un est en Christ, il est une nouvelle cr√©ature. Les choses anciennes sont pass√©es; voici, toutes choses sont devenues nouvelles.", reference: "2 Corinthiens 5:17" },
                        reminder: "Accueillez la nouveaut√© que le Christ vous offre chaque jour.",
                        spiritualChallengeTheme: "Nouveaux D√©parts",
                        spiritualChallengePrompt: "Quelle 'ancienne' habitude ou mentalit√© pouvez-vous laisser derri√®re vous aujourd'hui pour embrasser le 'nouveau' ?"
                    },
                    // Jour 27
                    {
                        scripture: { text: "Car Dieu a tant aim√© le monde qu'il a donn√© son Fils unique, afin que quiconque croit en lui ne p√©risse point, mais qu'il ait la vie √©ternelle.", reference: "Jean 3:16" },
                        reminder: "L'amour de Dieu est illimit√©, offrant la vie √©ternelle.",
                        spiritualChallengeTheme: "Amour Divin",
                        spiritualChallengePrompt: "Comment pouvez-vous refl√©ter l'amour illimit√© de Dieu √† quelqu'un d'autre aujourd'hui ?"
                    },
                    // Jour 28
                    {
                        scripture: { text: "La joie de l'√âternel est votre force.", reference: "N√©h√©mie 8:10" },
                        reminder: "Trouvez votre force non pas dans les circonstances, mais dans la joie de l'√âternel.",
                        spiritualChallengeTheme: "Joie comme Force",
                        spiritualChallengePrompt: "Comment pouvez-vous puiser dans la joie de l'√âternel pour trouver la force pour les t√¢ches d'aujourd'hui ?"
                    },
                    // Jour 29
                    {
                        scripture: { text: "Et voici, je suis avec vous tous les jours, jusqu'√† la fin du monde.", reference: "Matthieu 28:20" },
                        reminder: "Vous n'√™tes jamais seul ; la pr√©sence de Dieu est constante.",
                        spiritualChallengeTheme: "Pr√©sence Constante",
                        spiritualChallengePrompt: "Comment pouvez-vous √™tre plus conscient de la pr√©sence constante de Dieu avec vous aujourd'hui ?"
                    },
                    // Jour 30
                    {
                        scripture: { text: "Tout ce que vous faites, faites-le de bon c≈ìur, comme pour le Seigneur et non pour des hommes.", reference: "Colossiens 3:23" },
                        reminder: "Chaque t√¢che, grande ou petite, peut √™tre un acte d'adoration.",
                        spiritualChallengeTheme: "Travail et But",
                        spiritualChallengePrompt: "Comment pouvez-vous aborder votre travail ou vos t√¢ches quotidiennes avec un sens renouvel√© du but pour la gloire de Dieu ?"
                    }
                ],
                weeklyPrayerSuggestions: [
                    // Semaine 1
                    "P√®re C√©leste, en ce d√©but de semaine, je prie pour que Ta sagesse guide mes d√©cisions et Ta force m'aide √† accomplir mes t√¢ches. Aide-moi √† me confier en Ton plan parfait, m√™me lorsque le chemin n'est pas clair. Que Ta pr√©sence soit ma constante compagnie. Amen.",
                    // Semaine 2
                    "Seigneur, je viens devant Toi cette semaine cherchant Ta paix au milieu de toutes les anxi√©t√©s. Sois ma lumi√®re et ma forteresse. Accorde-moi le courage d'affronter les d√©fis et la gr√¢ce de me reposer dans Ton amour infaillible. Que Ton r√©confort remplisse mon c≈ìur. Amen.",
                    // Semaine 3
                    "Dieu bienveillant, je prie pour une force renouvel√©e et une nouvelle perspective alors que j'avance dans cette semaine. Aide-moi √† esp√©rer en Toi, sachant que Tu me rel√®veras et me permettras de surmonter la fatigue. Accorde-moi la patience d'attendre Ton timing et de voir Ta main en toutes choses. Amen.",
                    // Semaine 4
                    "P√®re mis√©ricordieux, cette semaine, je cherche Ton pardon et Ton renouveau. Purifie mon c≈ìur et renouvelle un esprit ferme en moi. Aide-moi √† marcher avec int√©grit√©, √† faire preuve de compassion envers les autres et √† refl√©ter Ton amour illimit√© dans tout ce que je fais. Amen."
                ]
            }
        };

        /**
         * Initializes the canvas for drawing.
         */
        const initializeCanvas = () => {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');

            // Set canvas dimensions to fill its container
            const setCanvasDimensions = () => {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                // Clear and redraw when resized to maintain aspect ratio and prevent stretching
                redrawCanvas();
            };

            setCanvasDimensions(); // Set initial dimensions
            window.addEventListener('resize', setCanvasDimensions); // Adjust on resize

            // Drawing event listeners for mouse
            canvas.addEventListener('mousedown', (e) => {
                if (activePresetIcon) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    drawingActions.push({ type: 'icon', x, y, svg: activePresetIcon });
                    redrawCanvas();
                    activePresetIcon = null; // Deselect icon after drawing
                    generatePresetIconButtons(); // Re-render buttons to show deselection
                    canvas.style.cursor = 'crosshair'; // Reset cursor
                    return;
                }
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
                drawingActions.push({ type: 'path', segments: [], color: penColor, size: penSize });
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDrawing) return;
                const currentX = e.offsetX;
                const currentY = e.offsetY;
                const lastPath = drawingActions[drawingActions.length - 1];
                if (lastPath && lastPath.type === 'path') {
                    lastPath.segments.push({ x1: lastX, y1: lastY, x2: currentX, y2: currentY });
                }
                lastX = currentX;
                lastY = currentY;
                redrawCanvas(); // Redraw entire canvas for smooth drawing
            });

            canvas.addEventListener('mouseup', () => isDrawing = false);
            canvas.addEventListener('mouseout', () => isDrawing = false); // Stop drawing if mouse leaves canvas

            // Drawing event listeners for touch
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Prevent scrolling
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;

                if (activePresetIcon) {
                    drawingActions.push({ type: 'icon', x, y, svg: activePresetIcon });
                    redrawCanvas();
                    activePresetIcon = null; // Deselect icon after drawing
                    generatePresetIconButtons(); // Re-render buttons to show deselection
                    canvas.style.cursor = 'crosshair'; // Reset cursor
                    return;
                }
                isDrawing = true;
                [lastX, lastY] = [x, y];
                drawingActions.push({ type: 'path', segments: [], color: penColor, size: penSize });
            }, { passive: false });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault(); // Prevent scrolling
                if (!isDrawing) return;
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const currentX = touch.clientX - rect.left;
                const currentY = touch.clientY - rect.top;

                const lastPath = drawingActions[drawingActions.length - 1];
                if (lastPath && lastPath.type === 'path') {
                    lastPath.segments.push({ x1: lastX, y1: lastY, x2: currentX, y2: currentY });
                }
                lastX = currentX;
                lastY = currentY;
                redrawCanvas(); // Redraw entire canvas for smooth drawing
            }, { passive: false });

            canvas.addEventListener('touchend', () => isDrawing = false);
            canvas.addEventListener('touchcancel', () => isDrawing = false);

            // Pen color and size controls
            document.getElementById('penColor').addEventListener('input', (e) => {
                penColor = e.target.value;
            });
            document.getElementById('penSize').addEventListener('input', (e) => {
                penSize = parseInt(e.target.value);
                document.getElementById('penSizeValue').textContent = penSize;
            });
            document.getElementById('clearCanvas').addEventListener('click', () => {
                drawingActions = []; // Clear all stored drawing actions
                redrawCanvas(); // Clear the visual canvas
            });
        };

        /**
         * Redraws the entire canvas based on the stored drawingActions array.
         */
        const redrawCanvas = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ffffff'; // Set background to white
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawingActions.forEach(action => {
                if (action.type === 'path') {
                    ctx.strokeStyle = action.color;
                    ctx.lineWidth = action.size;
                    ctx.lineCap = 'round';
                    action.segments.forEach(segment => {
                        ctx.beginPath();
                        ctx.moveTo(segment.x1, segment.y1);
                        ctx.lineTo(segment.x2, segment.y2);
                        ctx.stroke();
                    });
                } else if (action.type === 'icon') {
                    drawPresetIconOnCanvas(action.x, action.y, action.svg);
                }
            });
        };

        /**
         * Draws a selected preset SVG icon onto the canvas at specified coordinates.
         * This is called by redrawCanvas, so it doesn't add to drawingActions.
         * @param {number} x - X coordinate on canvas.
         * @param {number} y - Y coordinate on canvas.
         * @param {string} svgString - The SVG string to draw.
         */
        const drawPresetIconOnCanvas = (x, y, svgString) => {
            const img = new Image();
            const svgDataUrl = 'data:image/svg+xml;base64,' + btoa(svgString);
            const iconSize = 50; // pixels

            img.onload = () => {
                ctx.drawImage(img, x - iconSize / 2, y - iconSize / 2, iconSize, iconSize);
            };
            img.src = svgDataUrl;
        };

        /**
         * Generates and renders preset icon buttons.
         */
        const generatePresetIconButtons = () => {
            const presetIconContainer = document.getElementById('preset-icon-container');
            presetIconContainer.innerHTML = ''; // Clear existing buttons

            presetIcons.forEach(icon => {
                const button = document.createElement('button');
                button.classList.add('preset-icon-button'); // Apply common styling class
                button.innerHTML = icon.svg; // Set innerHTML to the SVG string

                // Add a title for accessibility and hover tooltip
                button.title = icon.name[currentLanguage];

                if (activePresetIcon === icon.svg) {
                    button.classList.add('selected'); // Highlight selected preset icon button
                } else {
                    button.classList.remove('selected'); // Ensure it's not selected
                }

                button.addEventListener('click', () => {
                    // Deselect previous if any
                    if (activePresetIcon) {
                        const prevSelectedButton = presetIconContainer.querySelector(`.preset-icon-button.selected`);
                        if (prevSelectedButton) {
                            prevSelectedButton.classList.remove('selected');
                        }
                    }

                    if (activePresetIcon === icon.svg) {
                        // If clicking the same icon, deselect it
                        activePresetIcon = null;
                        canvas.style.cursor = 'crosshair'; // Reset cursor
                    } else {
                        // Select new icon
                        activePresetIcon = icon.svg;
                        button.classList.add('selected'); // Apply selected class to the new button
                        canvas.style.cursor = 'copy'; // Change cursor to indicate stamping
                    }
                });
                presetIconContainer.appendChild(button);
            });
        };


        /**
         * Updates the display area with the currently selected emojis.
         */
        const updateSelectedEmojisDisplay = () => {
            document.getElementById('selected-emojis-display').textContent = selectedEmojis.join(' ');
        };

        /**
         * Toggles the selection of an emoji and updates the display.
         * @param {string} emoji - The emoji character to toggle.
         * @param {HTMLElement} button - The button element corresponding to the emoji.
         */
        const toggleEmojiSelection = (emoji, button) => {
            const index = selectedEmojis.indexOf(emoji);
            if (index > -1) {
                // Emoji is already selected, so unselect it
                selectedEmojis.splice(index, 1);
                button.classList.remove('bg-blue-200', 'border-blue-500');
                button.classList.add('bg-gray-100', 'border-gray-300');
            } else {
                // Emoji is not selected, try to select it
                if (selectedEmojis.length < 4) {
                    // Only allow selection if less than 4 emojis are already selected
                    selectedEmojis.push(emoji);
                    button.classList.add('bg-blue-200', 'border-blue-500');
                    button.classList.remove('bg-gray-100', 'border-gray-300');
                } else {
                    // Optionally, provide user feedback that max selection is reached
                    return;
                }
            }
            updateSelectedEmojisDisplay(); // Update the display of selected emojis
        };

        /**
         * Generates and renders all emoji buttons in the picker container.
         * Attaches click listeners and sets initial styling based on selection.
         */
        const generateEmojiButtons = () => {
            const emojiContainer = document.getElementById('emoji-picker-container');
            emojiContainer.innerHTML = ''; // Clear any existing buttons

            allEmojis.forEach(emoji => {
                const emojiItemDiv = document.createElement('div');
                emojiItemDiv.classList.add('flex', 'flex-col', 'items-center', 'justify-center', 'p-1', 'rounded-md'); // Container for emoji and name

                const button = document.createElement('button');
                button.textContent = emoji;
                button.classList.add(
                    'emoji-button', 'p-2', 'rounded-full', 'text-2xl', 'border-2',
                    'transition', 'duration-150', 'ease-in-out', 'hover:scale-110'
                );
                // Set initial styling based on whether the emoji is currently selected
                if (selectedEmojis.includes(emoji)) {
                    button.classList.add('bg-blue-200', 'border-blue-500');
                } else {
                    button.classList.add('bg-gray-100', 'border-gray-300');
                }
                // Add click event listener to toggle selection
                button.addEventListener('click', () => toggleEmojiSelection(emoji, button));

                const emojiNameSpan = document.createElement('span');
                emojiNameSpan.classList.add('text-xs', 'text-gray-600', 'mt-1', 'text-center', 'emoji-name');
                // Ensure emojiNames[emoji] exists before trying to access properties
                emojiNameSpan.textContent = emojiNames[emoji] ? emojiNames[emoji][currentLanguage] : '';

                emojiItemDiv.appendChild(button);
                emojiItemDiv.appendChild(emojiNameSpan);
                emojiContainer.appendChild(emojiItemDiv);
            });
        };

        /**
         * Updates the display area with the currently selected action steps.
         */
        const updateSelectedActionStepsDisplay = () => {
            document.getElementById('selected-action-steps-display').textContent = selectedActionSteps.join(' ‚Ä¢ ');
        };

        /**
         * Toggles the selection of an action step and updates the display.
         * @param {string} actionStep - The action step phrase to toggle.
         * @param {HTMLElement} button - The button element corresponding to the action step.
         */
        const toggleActionStepSelection = (actionStep, button) => {
            const index = selectedActionSteps.indexOf(actionStep);
            // Remove all color classes from the button first to reset it
            actionStepColorClasses.forEach(colorClass => button.classList.remove(colorClass));

            if (index > -1) {
                // Action step is already selected, so unselect it
                selectedActionSteps.splice(index, 1);
                button.classList.remove('selected'); // Remove the generic 'selected' class
            } else {
                // Action step is not selected, try to select it
                if (selectedActionSteps.length < 4) { // Changed limit from 2 to 4 action steps
                    selectedActionSteps.push(actionStep);
                    button.classList.add('selected'); // Add generic 'selected' class

                    // Assign a unique color based on its position in the *currently selected* array
                    const colorIndex = selectedActionSteps.indexOf(actionStep); // Get its position in the selected array
                    button.classList.add(actionStepColorClasses[colorIndex % actionStepColorClasses.length]);
                } else {
                    // Optionally, provide user feedback that max selection is reached
                    return;
                }
            }
            // After modifying selectedActionSteps, re-render all buttons to ensure correct colors are applied
            // to previously selected items whose positions might have shifted.
            generateActionStepButtons();
            updateSelectedActionStepsDisplay(); // Update the display of selected action steps
        };


        /**
         * Generates and renders all action step buttons in the picker container.
         * Attaches click listeners and sets initial styling based on selection.
         */
        const generateActionStepButtons = () => {
            const actionStepContainer = document.getElementById('action-step-picker-container');
            actionStepContainer.innerHTML = ''; // Clear any existing buttons

            allActionSteps.forEach(action => {
                const button = document.createElement('button');
                button.textContent = action[currentLanguage];
                button.classList.add('action-step-button');

                // Check if this action step is currently selected
                const isSelected = selectedActionSteps.includes(action[currentLanguage]);
                if (isSelected) {
                    // Find the index of this action step in the selectedActionSteps array
                    const selectedIndex = selectedActionSteps.indexOf(action[currentLanguage]);
                    // Apply the corresponding color class
                    const colorClass = actionStepColorClasses[selectedIndex % actionStepColorClasses.length];
                    button.classList.add(colorClass);
                    button.classList.add('selected'); // Also add the generic 'selected' class
                }
                
                // Add click event listener to toggle selection
                button.addEventListener('click', () => toggleActionStepSelection(action[currentLanguage], button));
                actionStepContainer.appendChild(button);
            });
        };

        /**
         * Formats a Date object into a "YYYY-MM-DD" string.
         * @param {Date} date - The date object.
         * @returns {string} Formatted date string.
         */
        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        /**
         * Clears all input fields and canvas.
         */
        const clearEntryFields = () => {
            document.getElementById('verse-reflection-textarea').value = '';
            document.getElementById('prayer-textarea').value = '';
            document.getElementById('spiritual-challenge-textarea').value = '';
            document.getElementById('gratitude-textarea').value = '';
            selectedEmojis = [];
            selectedActionSteps = [];
            drawingActions = []; // Clear drawing actions
            updateSelectedEmojisDisplay();
            generateActionStepButtons(); // Re-render action buttons to clear selections
            redrawCanvas(); // Clear the visual canvas
        };

        /**
         * Displays a status message to the user.
         * @param {string} message - The message to display.
         * @param {string} type - 'success', 'error', or 'info'.
         */
        const showStatusMessage = (message, type) => {
            const statusDiv = document.getElementById('save-status-message');
            statusDiv.textContent = message;
            statusDiv.className = 'text-center text-sm mt-2'; // Reset classes
            if (type === 'success') {
                statusDiv.classList.add('text-green-600');
            } else if (type === 'error') {
                statusDiv.classList.add('text-red-600');
            } else {
                statusDiv.classList.add('text-gray-600');
            }
            setTimeout(() => statusDiv.textContent = '', 3000); // Clear after 3 seconds
        };

        /**
         * Saves the current day's entry to Local Storage.
         */
        const saveEntry = () => {
            showStatusMessage("Saving entry to local storage...", 'info');
            const dateString = formatDate(currentDate);

            const entryData = {
                date: dateString,
                verseReflection: document.getElementById('verse-reflection-textarea').value,
                personalPrayer: document.getElementById('prayer-textarea').value,
                spiritualChallenge: document.getElementById('spiritual-challenge-textarea').value,
                gratitudeText: document.getElementById('gratitude-textarea').value,
                selectedEmojis: selectedEmojis,
                selectedActionSteps: selectedActionSteps,
                drawingActions: drawingActions // Store the array of drawing commands
            };

            try {
                localStorage.setItem(`journal_entry_${dateString}`, JSON.stringify(entryData));
                showStatusMessage("Entry saved successfully to local storage!", 'success');
            } catch (e) {
                console.error("Error saving to local storage: ", e);
                showStatusMessage("Error saving entry to local storage.", 'error');
            }
        };

        /**
         * Loads an entry for a specific date from Local Storage.
         * @param {Date} dateToLoad - The Date object for the entry to load.
         */
        const loadEntry = (dateToLoad) => {
            showStatusMessage("Loading entry from local storage...", 'info');
            const dateString = formatDate(dateToLoad);

            try {
                const storedData = localStorage.getItem(`journal_entry_${dateString}`);

                clearEntryFields(); // Clear current fields before loading new data

                if (storedData) {
                    const data = JSON.parse(storedData);
                    document.getElementById('verse-reflection-textarea').value = data.verseReflection || '';
                    document.getElementById('prayer-textarea').value = data.personalPrayer || '';
                    document.getElementById('spiritual-challenge-textarea').value = data.spiritualChallenge || '';
                    document.getElementById('gratitude-textarea').value = data.gratitudeText || '';
                    selectedEmojis = data.selectedEmojis || [];
                    selectedActionSteps = data.selectedActionSteps || [];
                    drawingActions = data.drawingActions || []; // Load drawing actions
                    
                    updateSelectedEmojisDisplay();
                    generateActionStepButtons(); // Re-render to show loaded selections
                    redrawCanvas(); // Redraw canvas with loaded actions

                    showStatusMessage("Entry loaded from local storage.", 'success');
                } else {
                    showStatusMessage("No entry found for this date. Starting a new one.", 'info');
                }
                currentDate = dateToLoad; // Update current date after successful load attempt
                updateContent(currentLanguage); // Update daily content for the new date
            } catch (e) {
                console.error("Error loading from local storage: ", e);
                showStatusMessage("Error loading entry from local storage.", 'error');
            }
        };

        /**
         * Updates all dynamic content on the page based on the selected language and current date.
         * @param {string} lang - The language code ('en' or 'fr').
         */
        const updateContent = (lang) => {
            // Calculate day index (0-29)
            const dayIndex = (currentDate.getDate() - 1) % content[lang].dailyContent.length;
            const dailyData = content[lang].dailyContent[dayIndex];

            // Calculate week index (0-3) for weekly prayers
            const weekIndex = Math.floor((currentDate.getDate() - 1) / 7) % content[lang].weeklyPrayerSuggestions.length;
            const weeklyPrayer = content[lang].weeklyPrayerSuggestions[weekIndex];


            // Update static elements based on language
            document.getElementById('main-title').textContent = content[lang].mainTitle;
            document.getElementById('scripture-title').textContent = content[lang].scriptureTitle;
            document.getElementById('verse-reflection-title').textContent = content[lang].verseReflectionTitle;
            document.getElementById('verse-reflection-textarea').placeholder = content[lang].verseReflectionPlaceholder;
            document.getElementById('personal-prayer-title').textContent = content[lang].personalPrayerTitle;
            document.getElementById('personal-prayer-subtitle').textContent = content[lang].personalPrayerSubtitle;
            document.getElementById('gratitude-title').textContent = content[lang].gratitudeTitle;
            document.getElementById('gratitude-subtitle').textContent = content[lang].gratitudeSubtitle;
            document.getElementById('emoji-instructions').textContent = content[lang].emojiInstructions; // New emoji instructions
            document.getElementById('gratitude-textarea').placeholder = content[lang].gratitudePlaceholder;

            // Action Step section updates
            document.getElementById('action-step-title').textContent = content[lang].actionStepTitle;
            document.getElementById('action-step-subtitle').textContent = content[lang].actionStepSubtitle;
            document.getElementById('action-instructions').textContent = content[lang].actionInstructions;
            document.getElementById('action-step-textarea').placeholder = content[lang].actionStepPlaceholder;

            // Visual Space section updates
            document.getElementById('visual-space-title').textContent = content[lang].visualSpaceTitle;
            document.getElementById('visual-space-subtitle').textContent = content[lang].visualSpaceSubtitle;
            document.getElementById('drawing-tools-title').textContent = content[lang].drawingToolsTitle;
            document.getElementById('pen-color-label').textContent = content[lang].penColorLabel;
            document.getElementById('pen-size-label').innerHTML = `${content[lang].penSizeLabel} <span id="penSizeValue">${penSize}</span>px`;
            document.getElementById('clear-canvas-button-text').textContent = content[lang].clearCanvasButtonText;
            document.getElementById('preset-icons-title').textContent = content[lang].presetIconsTitle;
            document.getElementById('paste-image-info').textContent = content[lang].pasteImageInfo;


            // Update dynamic daily content
            document.getElementById('daily-reminder').textContent = dailyData.reminder;
            document.getElementById('scripture-text').textContent = dailyData.scripture.text;
            document.getElementById('scripture-reference').textContent = dailyData.scripture.reference;
            document.getElementById('prayer-textarea').placeholder = weeklyPrayer; // Use weekly prayer


            const spiritualChallengeFullTitleElement = document.getElementById('spiritual-challenge-full-title');
            if (spiritualChallengeFullTitleElement) {
                spiritualChallengeFullTitleElement.textContent = content[lang].spiritualChallengeTitle + " " + dailyData.spiritualChallengeTheme;
            } else {
                console.error("Element with ID 'spiritual-challenge-full-title' not found.");
            }

            document.getElementById('challenge-prompt').textContent = dailyData.spiritualChallengePrompt;
            document.getElementById('spiritual-challenge-textarea').placeholder = dailyData.spiritualChallengePrompt;

            // Update current date display
            document.getElementById('current-date-display').textContent = currentDate.toLocaleDateString(lang === 'en' ? 'en-US' : 'fr-FR', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            // Re-generate emoji buttons to ensure correct styling for selected/unselected states and update names
            generateEmojiButtons();
            updateSelectedEmojisDisplay(); // Ensure selected emojis are displayed after content update

            // Re-generate action step buttons to ensure correct styling and language
            generateActionStepButtons();
            updateSelectedActionStepsDisplay(); // Ensure selected action steps are displayed

            // Generate preset icon buttons for Visual Space
            generatePresetIconButtons();


            // Update language toggle button styling
            if (lang === 'en') {
                document.getElementById('lang-en').classList.add('bg-blue-500', 'text-white');
                document.getElementById('lang-en').classList.remove('bg-gray-300', 'text-gray-800');
                document.getElementById('lang-fr').classList.add('bg-gray-300', 'text-gray-800');
                document.getElementById('lang-fr').classList.remove('bg-blue-500', 'text-white');
            } else {
                document.getElementById('lang-fr').classList.add('bg-blue-500', 'text-white');
                document.getElementById('lang-fr').classList.remove('bg-gray-300', 'text-gray-800');
                document.getElementById('lang-en').classList.add('bg-gray-300', 'text-gray-800');
                document.getElementById('lang-en').classList.remove('bg-blue-500', 'text-white');
            }
        };

        // Event listener for when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize Canvas and its drawing functionality
            initializeCanvas();

            // Detect browser language preference for initial load
            const browserLang = navigator.language.split('-')[0];
            if (browserLang === 'fr') {
                currentLanguage = 'fr';
            }

            // Generate buttons and update all content based on the initial language
            generateEmojiButtons();
            generateActionStepButtons(); // Generate action step buttons on load
            generatePresetIconButtons(); // Generate preset icon buttons on load
            
            // Load today's entry initially
            loadEntry(currentDate);

            // Add event listeners for language toggle buttons
            document.getElementById('lang-en').addEventListener('click', () => {
                currentLanguage = 'en';
                updateContent('en');
            });

            document.getElementById('lang-fr').addEventListener('click', () => {
                currentLanguage = 'fr';
                updateContent('fr');
            });

            // Add event listeners for journal navigation and save
            document.getElementById('prev-day-btn').addEventListener('click', () => {
                const newDate = new Date(currentDate);
                newDate.setDate(newDate.getDate() - 1);
                loadEntry(newDate);
            });

            document.getElementById('next-day-btn').addEventListener('click', () => {
                const newDate = new Date(currentDate);
                newDate.setDate(newDate.getDate() + 1);
                loadEntry(newDate);
            });

            document.getElementById('save-entry-btn').addEventListener('click', saveEntry);
        });
    </script>
</body>
</html>
