<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RÃ©flexion Matinale CrÃ©ative</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Great+Vibes&family=Delius&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #FFF5E1; font-family: 'Lato', sans-serif; color: #4A4A4A; min-height: 100vh; padding: 1rem; }
        .glass { background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.6); border-radius: 2.5rem; }
        .paper { background-color: #fdfaf0; border: 1px solid #faedcd; border-radius: 1.5rem; }
        .serif { font-family: 'Playfair Display', serif; color: #1e1b4b; }
        .handwritten { font-family: 'Great Vibes', cursive; color: #b45309; font-size: 3.5rem; }
        .scripture { font-family: 'Delius', cursive; }
        canvas { background: white; border: 2px dashed #cbd5e1; border-radius: 1.5rem; cursor: crosshair; touch-action: none; }
        .mood-btn { font-size: 3rem; transition: transform 0.2s; cursor: pointer; opacity: 0.6; }
        .active-mood { transform: scale(1.3); opacity: 1; filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.4)); }
    </style>
</head>
<body class="flex flex-col items-center">

    <div class="max-w-5xl w-full glass p-6 md:p-12 shadow-2xl my-6">
        
        <div class="text-center mb-10">
            <h1 class="handwritten">RÃ©flexion Matinale</h1>
            <p class="serif uppercase tracking-widest text-xs font-bold">Mon Espace CrÃ©atif My1Prayer</p>
        </div>

        <div class="grid md:grid-cols-2 gap-8 mb-10">
            <div class="space-y-6">
                <div class="paper p-6 text-center shadow-sm border-l-4 border-amber-400">
                    <p class="scripture text-lg italic text-gray-700">"Ne vous inquiÃ©tez de rien..."</p>
                    <p class="text-right text-xs mt-2 font-bold text-amber-700">Phil 4:6</p>
                </div>
                <div class="p-6 bg-white/30 rounded-[2rem] border border-white/50">
                    <h3 class="serif font-bold uppercase text-xs mb-3 flex gap-2"><i data-lucide="pen-tool" size="18"></i> Ma PriÃ¨re</h3>
                    <textarea id="prayerText" oninput="saveData()" class="w-full h-40 bg-transparent border-none focus:ring-0 text-gray-700 scripture text-lg" placeholder="Seigneur..."></textarea>
                </div>
            </div>

            <div class="space-y-6">
                <div class="p-6 bg-white/30 rounded-[2rem] border border-white/50 text-center">
                    <h3 class="serif font-bold uppercase text-xs mb-4">Humeur & Progression</h3>
                    <div class="flex justify-around mb-6">
                        <span onclick="setMood('ðŸ¤©', this)" class="mood-btn">ðŸ¤©</span>
                        <span onclick="setMood('âœ¨', this)" class="mood-btn">âœ¨</span>
                        <span onclick="setMood('ðŸ’›', this)" class="mood-btn">ðŸ’›</span>
                        <span onclick="setMood('ðŸ˜„', this)" class="mood-btn">ðŸ˜„</span>
                        <span onclick="setMood('ðŸ˜”', this)" class="mood-btn">ðŸ˜”</span>
                    </div>
                    <div id="weeklyHistory" class="grid grid-cols-7 gap-2"></div>
                </div>
            </div>
        </div>

        <div class="space-y-4">
            <div class="flex justify-between items-center">
                <h3 class="serif font-bold uppercase text-xs flex gap-2 items-center"><i data-lucide="palette" size="20"></i> Espace CrÃ©atif</h3>
                
                <div class="flex gap-3 items-center bg-white/40 p-2 rounded-3xl border border-white/60">
                    <label class="cursor-pointer bg-amber-50 text-amber-700 px-3 py-1 rounded-full text-[10px] font-bold uppercase border border-amber-200">
                        <i data-lucide="image" size="14" class="inline"></i> Image <input type="file" id="imageLoader" class="hidden" accept="image/*">
                    </label>
                    <input type="color" id="color" class="w-8 h-8 rounded-full cursor-pointer bg-transparent border-none" value="#4f46e5">
                    <button onclick="clearCanvas()" class="px-3 py-1 bg-red-50 text-red-600 rounded-full text-[10px] font-bold uppercase">Effacer</button>
                </div>
            </div>
            
            <div class="relative group">
                <canvas id="canvas" class="w-full h-[450px] shadow-inner"></canvas>
                <div class="absolute bottom-4 right-6 text-[10px] text-gray-400 italic pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity">
                    Double-cliquez pour Ã©crire au clavier
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function initCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            ctx.lineCap = 'round';
            ctx.lineWidth = 3;
        }

        // --- DESSIN AU CRAYON ---
        canvas.onmousedown = (e) => { drawing = true; ctx.beginPath(); ctx.moveTo(e.offsetX, e.offsetY); };
        canvas.onmousemove = (e) => { 
            if(drawing) { 
                ctx.strokeStyle = document.getElementById('color').value;
                ctx.lineTo(e.offsetX, e.offsetY); 
                ctx.stroke(); 
            } 
        };
        window.onmouseup = () => drawing = false;

        // --- TEXTE AU DOUBLE CLIC (CLAVIER) ---
        canvas.ondblclick = (e) => {
            const text = prompt("Ã‰crivez votre mot ou verset :");
            if (text) {
                ctx.font = "24px Delius, cursive";
                ctx.fillStyle = document.getElementById('color').value;
                ctx.fillText(text, e.offsetX, e.offsetY);
            }
        };

        // --- IMPORT IMAGE ---
        document.getElementById('imageLoader').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    const ratio = Math.min(canvas.width / img.width, canvas.height / img.height);
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, img.width, img.height, (canvas.width - img.width*ratio)/2, (canvas.height - img.height*ratio)/2, img.width*ratio, img.height*ratio);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        // --- SAUVEGARDE & HISTORIQUE ---
        let journalData = JSON.parse(localStorage.getItem('my1prayer_data')) || {};
        const today = new Date().toISOString().split('T')[0];

        function setMood(mood, el) {
            document.querySelectorAll('.mood-btn').forEach(m => m.classList.remove('active-mood'));
            el.classList.add('active-mood');
            if(!journalData[today]) journalData[today] = {};
            journalData[today].mood = mood;
            localStorage.setItem('my1prayer_data', JSON.stringify(journalData));
            updateHistory();
        }

        function updateHistory() {
            const historyDiv = document.getElementById('weeklyHistory');
            historyDiv.innerHTML = '';
            for (let i = 6; i >= 0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const dateKey = d.toISOString().split('T')[0];
                const dayName = d.toLocaleDateString('fr-FR', { weekday: 'short' });
                const mood = journalData[dateKey]?.mood || 'â€¢';
                historyDiv.innerHTML += `<div class="p-2 border rounded-xl bg-white/50 text-center ${dateKey === today ? 'border-amber-400 bg-amber-50' : 'border-transparent'}"><div class="text-[8px] font-bold uppercase text-indigo-300">${dayName}</div><div class="text-lg">${mood}</div></div>`;
            }
        }

        function clearCanvas() { ctx.clearRect(0,0,canvas.width,canvas.height); }
        window.onload = () => { initCanvas(); updateHistory(); };
    </script>
</body>
</html>
